{% extends 'base.html' %}

{% block content %}

<h1>Comparison Rules</h1>

<button id="createRuleButton" type="button" class="btn btn-primary">Create</button>

<div class="rules">

    <table class="table">
        <thead class="thead-dark">
            <tr>
                <th scope="col">Rule Name</th>
                <th scope="col">Last Updated</th>
                <th scope="col">Actions</th>
            </tr>
        </thead>
        <tbody>

            {% for rule in rules %}

            <tr class="rule" id="{{rule._id}}" valign="middle">
                <td>
                    <a href="#" class="edit-rule" data-toggle="tooltip" data-placement="top" title="{{rule.timestamp}}"
                        data-test="rule-name" onclick="openRuleDetails(this.closest('tr').id)">{{rule.rule_name}}</a>
                </td>
                <td>
                    <span data-test="rule-update-time">{{rule.timestamp}}</span>
                </td>
                <td>
                    <ion-icon name="trash-outline" size="large" class="delete-rule-button btn btn-md btn-light"
                        onclick="deleteRule(this)"></ion-icon>
                </td>
            </tr>

            {% endfor %}
        </tbody>
    </table>

</div>

<script type="text/javascript">
    document.getElementById("createRuleButton").onclick = () => location.href = `/rules/0`

    function openRuleDetails(rule_id) {
        location.href = `/rules/${rule_id}`
    }

    function deleteRuleFromDatabase(rule_id) {
        console.log(`trying to delete ${rule_id}`)
        let outcome

        let url = `/rules/${rule_id}`
        console.log(url)
        fetch(url, { method: 'delete' })
            .then(response => response.json())
            .then(outcome => console.log(outcome))
    }

    function deleteRule(event) {
        {
            const row = event.closest("tr")
            console.log('deleting closest...')
            deleteRuleFromDatabase(row.id)
            row.remove()
        }
    }

</script>


{% endblock content %}