{% extends 'base.html' %}

{% block content %}

<h1>On rules page</h1>

<button id="createRuleButton" type="button" class="btn btn-primary">Create</button>

<ul class="rules">
    {% for rule in rules %}

    <div class="rule" id="{{rule._id}}">
        <li>{{rule.rule_name}} - {{rule.date_created}}</li>
        <input type="button" class="ibtnDel btn btn-md btn-danger" value="Delete">
    </div>

    {% endfor %}
</ul>

<script type="text/javascript">
    document.getElementById("createRuleButton").onclick = () => location.href = '{{url_for("create_rule")}}';

    function deleteData(rule_id) {
        console.log(`trying to delete ${rule_id}`)
        let outcome

        let url = `/rules/delete/${rule_id}`
        console.log(url)
        fetch(url, { method: 'delete' })
            .then(response => response.json())
            .then(outcome => console.log(outcome))
    }

    $('input[class~=ibtnDel]').click(function (event) {
        const parent_div = $(this).closest("div")[0]
        // console.log(parent.id);
        // console.log($(this).parent())
        // const rule_id = $(this).parent().id
        deleteData(parent_div.id)
        parent_div.remove()
    });

</script>


{% endblock content %}