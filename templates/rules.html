{% extends 'base.html' %}

{% block content %}

<h1>On rules page</h1>

<button id="createRuleButton" type="button" class="btn btn-primary">Create</button>

<ul class="rules">
    {% for rule in rules %}

    <div class="rule" id="{{rule._id}}">
        <li>{{rule.rule_name}} - {{rule.timestamp}}</li>
        <input type="button" class="edit-rule btn btn-md btn-light" value="Edit"
            onclick="openRuleDetails(this.closest('div').id)">
        <input type="button" class="delete-rule-button btn btn-md btn-light" onclick="deleteRule(this)" value="Delete">
    </div>

    {% endfor %}
</ul>

<script type="text/javascript">
    document.getElementById("createRuleButton").onclick = () => location.href = `/rules/0`

    function openRuleDetails(rule_id) {
        location.href = `/rules/${rule_id}`
    }

    function deleteRuleFromDatabase(rule_id) {
        console.log(`trying to delete ${rule_id}`)
        let outcome

        let url = `/rules/${rule_id}`
        console.log(url)
        fetch(url, { method: 'delete' })
            .then(response => response.json())
            .then(outcome => console.log(outcome))
    }

    function deleteRule(event) {
        {
            const parent_div = event.closest("div")
            console.log('deleting closest...')
            deleteRuleFromDatabase(parent_div.id)
            parent_div.remove()
        }
    }

</script>


{% endblock content %}